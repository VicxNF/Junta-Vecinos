{% extends 'junta_vecinos/base.html' %}
{% load static %}
{% load humanize %}

{% block title %}Inicio{% endblock %}

{% block content %}
<div class="jumbotron text-center">
    <h1 class="display-4">Bienvenido al Sistema de la Junta de Vecinos de {{ comuna }}</h1>
    <p class="lead">Este es el portal principal.</p>
    <hr class="my-4">

    {% if user.is_authenticated %}
        {% if user.is_superuser %}
            <!-- Contenido para Administradores -->
            <div class="admin-section">
                <h2>Lista de Vecinos</h2>
                <ul class="list-group">
                    {% for vecino in vecinos %}
                        <li class="list-group-item loading-effect">
                            {{ vecino.nombres }} {{ vecino.apellidos }}
                        </li>
                    {% endfor %}
                </ul>
                <div class="mt-3">
                    <a href="{% url 'lista_vecinos' %}" class="btn btn-primary">Ver todos los vecinos</a>
                </div>
            </div>

            <hr class="my-4">

            <div class="admin-section">
                <h2>Solicitudes de Certificado</h2>
                <ul class="list-group">
                    {% for solicitud in solicitudes %}
                        <li class="list-group-item loading-effect">
                            {{ solicitud.vecino.nombres }} {{ solicitud.vecino.apellidos }} - Estado: {{ solicitud.estado }}
                        </li>
                    {% endfor %}
                </ul>
                <div class="mt-3">
                    <a href="{% url 'gestionar_solicitudes' %}" class="btn btn-primary">Ver todas las solicitudes</a>
                </div>
            </div>

            <hr class="my-4">

            <div class="admin-section">
                <h2>Postulaciones de Proyectos</h2>
                <ul class="list-group">
                    {% for postulacion in postulaciones %}
                        <li class="list-group-item loading-effect">
                            {{ postulacion.propuesta }} - Estado: {{ postulacion.estado }}
                        </li>
                    {% endfor %}
                </ul>
                <div class="mt-3">
                    <a href="{% url 'gestionar_proyectos' %}" class="btn btn-primary">Ver todas las postulaciones</a>
                </div>
            </div>

            <hr class="my-4">

            <div class="admin-section">
                <h2>Espacios Comunitarios</h2>
                <ul class="list-group">
                    {% for espacio in espacios %}
                        <li class="list-group-item loading-effect">
                            {{ espacio.nombre }} - Capacidad: {{ espacio.capacidad }}
                        </li>
                    {% endfor %}
                </ul>
                <div class="mt-3">
                    <a href="{% url 'lista_espacios' %}" class="btn btn-primary">Ver todos los espacios</a>
                </div>
            </div>

            <hr class="my-4">
        
            <div class="admin-section">
                <h2>Reservas de Espacios</h2>
                <ul class="list-group">
                    {% for reserva in reservas %}
                        <li class="list-group-item loading-effect">
                            {{ reserva.espacio.nombre }} - {{ reserva.fecha }} de {{ reserva.hora_inicio }} a {{ reserva.hora_fin }}
                            <br>
                            Hecha por: {{ reserva.usuario.first_name }} {{ reserva.usuario.last_name }}
                        </li>
                    {% endfor %}
                </ul>
                <div class="mt-3">
                    <a href="{% url 'lista_reservas' %}" class="btn btn-primary">Ver todas las reservas</a>
                </div>
            </div>

            <hr class="my-4">
            
            <div class="admin-section">
                <h2>Gestionar Actividades</h2>
                <div class="btn-group">
                    <a href="{% url 'crear_actividad' %}" class="btn btn-primary">Crear Actividad</a>
                    <a href="{% url 'lista_actividades' %}" class="btn btn-secondary">Ver Todas las Actividades</a>
                </div>
            </div>

            <hr class="my-4">
            
            <div class="admin-section">
                <h2>Gestionar Noticias</h2>
                <div class="btn-group">
                    <a href="{% url 'publicar_noticia' %}" class="btn btn-primary">Publicar Noticia</a>
                    <a href="{% url 'gestionar_noticias' %}" class="btn btn-secondary">Ver Todas las Noticias</a>
                </div>
            </div>

        {% else %}
            <!-- Contenido para Vecinos -->
            <div class="user-section">
                <p class="lead">Solicita aquí tu certificado de residencia</p>
                <div class="mt-4">
                    <a href="{% url 'solicitar_certificado' %}" class="btn btn-primary btn-lg mr-3">Solicitar certificado</a>
                </div>
            </div>

            <hr class="my-4">

            <div class="user-section">
                <p class="lead">Postula aquí a nuestros proyectos</p>
                <div class="mt-4">
                    <a href="{% url 'postular_proyecto' %}" class="btn btn-primary btn-lg mr-3">Postular</a>
                </div>
            </div>

            <hr class="my-4">

            <div class="user-section">
                <p class="lead">Revisa aquí los espacios disponibles para arriendo</p>
                <div class="mt-4">
                    <a href="{% url 'espacios_disponibles' %}" class="btn btn-primary btn-lg mr-3">Ver espacios</a>
                </div>
            </div>

            <hr class="my-4">

            <div class="user-section">
                <p class="lead">Revisa aquí las actividades vecinales</p>
                <div class="mt-4">
                    <a href="{% url 'lista_actividades' %}" class="btn btn-primary btn-lg mr-3">Ver actividades</a>
                </div>
            </div>

            <hr class="my-4">

            <div class="news-section">
                <h2>Noticias Recientes</h2>
                <div class="news-grid">
                    {% for noticia in noticias %}
                        <a href="{% url 'detalle_noticia' noticia.id %}" class="news-card">
                            <img src="{{ noticia.imagen.url }}" alt="{{ noticia.titulo }}" class="news-thumbnail">
                            <div class="news-content">
                                <div class="news-source">
                                    <span class="news-source-name">Junta de Vecinos {{ comuna }}</span>
                                </div>
                                <h3 class="news-title">{{ noticia.titulo }}</h3>
                                <p class="news-excerpt">{{ noticia.contenido|truncatewords:30 }}</p>
                                <div class="news-footer">
                                    <span class="news-time">hace {{ noticia.fecha_publicacion|timesince }}</span>
                                    <span class="news-read-more">Leer más →</span>
                                </div>
                            </div>
                        </a>
                    {% empty %}
                        <div class="empty-news">
                            <p>No hay noticias recientes disponibles.</p>
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% endif %}
    {% else %}
        <div class="guest-section">
            <p>Por favor, inicia sesión para acceder a más funciones.</p>
            <a href="{% url 'login' %}" class="btn btn-primary btn-lg">Iniciar Sesión</a>
        </div>
    {% endif %}
</div>
{% endblock %}